pico-8 cartridge // http://www.pico-8.com
version 16
__lua__
left,right,up,down,fire1,fire2=0,1,2,3,4,5
black,dark_blue,dark_purple,dark_green,brown,dark_gray,light_gray,white,red,orange,yellow,green,blue,indigo,pink,peach=0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15

cx,cy=0,0         -- camera-x, camera-y
screen_width=512 -- max-x

mario = {}
function _init()
  mario = {
    x=64,
    y=100,
    hsize=8,
    flipx=false,
    speed=2,
    sprite=16,
    walk_count=8,
    update=function(t) 
      t.sprite=16
      t.speed = btn(fire2) and 3 or 2
      if (btn(left)) then
        t.x=t.x<=t.hsize and t.hsize or t.x-t.speed
        t.flipx=true
        t.walk_count = t.walk_count<1 and 8 or t.walk_count-1
        t.sprite = t.walk_count<4 and 18 or 20
      end
      if (btn(right)) then
        t.x=t.x>=screen_width-t.hsize and screen_width-t.hsize or t.x+t.speed
        t.flipx=false
        t.walk_count = t.walk_count<1 and 8 or t.walk_count-1
        t.sprite = t.walk_count<4 and 18 or 20
      end
      if (btn(fire1)) then
        t.sprite=22
      end
    end,
    draw=function(t)
      print("("..t.x..","..t.y..")",t.x-t.hsize*2,t.y-t.hsize*2,white)
      spr(t.sprite,t.x-t.hsize,t.y-t.hsize,2,2,t.flipx)
      print("wc:"..t.walk_count..",spr:"..t.sprite..",spd:"..t.speed,cx,8,white)
    end
  }
end

function _update()
  mario:update()
  if (mario.x-cx>108) then cx=mario.x>screen_width-20 and screen_width-128 or mario.x-108 end
  if (mario.x-cx<20) then cx=mario.x<20 and 0 or mario.x-20 end
end

function _draw()
  cls()
  
  camera(cx,cy)
  line(cx,0,cx,128,dark_gray)
  line(screen_width-1,0,screen_width-1,128,red)
  rect(cx+20,cy+20,cx+108,cy+108,dark_gray)
  print("("..cx..","..cy.."):"..(mario.x-cx),cx,0,white)
  mario:draw()
  
end
__gfx__
00000000004444400044444000444440000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000004ffff0004ffff0004ffff0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700004f0f00004f0f00004f0f00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000004ffff0004ffff0004ffff0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000008888000888880000888880000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700008888000088888008888800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000cccc0000cccc0000cccc00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000c00c000c00c00000c000c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000088888000000000008888800000000000000000000000000000000000fff0000000000000000000000000000000000000000000000000000000000000000
0000888888888000000088888888800000000888880000000000008888800fff0000000000000000000000000000000000000000000000000000000000000000
0000333ff3f000000000333ff3f00000000088888888800000000888888888ff0000000000000000000000000000000000000000000000000000000000000000
0003f3fff3fff0000003f3fff3fff0000000333ff3f0000000000333ff3f03330000000000000000000000000000000000000000000000000000000000000000
0003f33fff3fff000003f33fff3fff000003f3fff3fff00000003f3fff3fff330000000000000000000000000000000000000000000000000000000000000000
00033ffff333300000033ffff33330000003f33fff3fff0000003f33fff3fff30000000000000000000000000000000000000000000000000000000000000000
00000fffffff000000000fffffff000000033ffff3333000000033ffff3333300000000000000000000000000000000000000000000000000000000000000000
0000338333000000003333883300000000000fffffff0000000000fffffff3000000000000000000000000000000000000000000000000000000000000000000
0003338338333000ff3333888333fff000003333830f000000333338333830000000000000000000000000000000000000000000000000000000000000000000
0033338888333300fff0338888833ff0000f333333fff00003333333833380030000000000000000000000000000000000000000000000000000000000000000
00ff38a88a83ff00ff00888a8880030000ff833333ff0000ff333333888880030000000000000000000000000000000000000000000000000000000000000000
00fff888888fff0000088888888833000033888888800000fff088388a88a8330000000000000000000000000000000000000000000000000000000000000000
00ff88888888ff00008888888888330000388888888000000f038888888888330000000000000000000000000000000000000000000000000000000000000000
00008880088800000338880008883300033888088800000000333888888888330000000000000000000000000000000000000000000000000000000000000000
00033300003330000333000000000000030000333000000003338888888000000000000000000000000000000000000000000000000000000000000000000000
00333300003333000033300000000000000000333300000003008888000000000000000000000000000000000000000000000000000000000000000000000000
